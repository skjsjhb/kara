"use strict";(()=>{var w=Object.create;var p=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var v=Object.getOwnPropertyNames;var R=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var P=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var S=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of v(e))!A.call(t,i)&&i!==r&&p(t,i,{get:()=>e[i],enumerable:!(n=y(e,i))||n.enumerable});return t};var _=(t,e,r)=>(r=t!=null?w(R(t)):{},S(e||!t||!t.__esModule?p(r,"default",{value:t,enumerable:!0}):r,t));var c=P((I,h)=>{function d(){}d.prototype={on:function(t,e,r){var n=this.e||(this.e={});return(n[t]||(n[t]=[])).push({fn:e,ctx:r}),this},once:function(t,e,r){var n=this;function i(){n.off(t,i),e.apply(r,arguments)}return i._=e,this.on(t,i,r)},emit:function(t){var e=[].slice.call(arguments,1),r=((this.e||(this.e={}))[t]||[]).slice(),n=0,i=r.length;for(n;n<i;n++)r[n].fn.apply(r[n].ctx,e);return this},off:function(t,e){var r=this.e||(this.e={}),n=r[t],i=[];if(n&&e)for(var s=0,a=n.length;s<a;s++)n[s].fn!==e&&n[s].fn._!==e&&i.push(n[s]);return i.length?r[t]=i:delete r[t],this}};h.exports=d;h.exports.TinyEmitter=d});var u=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,r)=>(r&=63,r<36?e+=r.toString(36):r<62?e+=(r-26).toString(36).toUpperCase():r>62?e+="-":e+="_",e),"");var g=_(c()),o=class t{constructor(){this.emitter=new g.TinyEmitter;this.ready=!1;this.on=this.emitter.on.bind(this.emitter);this.off=this.emitter.off.bind(this.emitter);this.once=this.emitter.once.bind(this.emitter);this.id=window._KARA_ID_,this.token=window._KARA_WS_TOKEN_,this.ws=window._KARA_WS_,this.ws.readyState==WebSocket.OPEN?this.ready=!0:this.ws.addEventListener("open",()=>{this.ready=!0});let e=this.ws.onmessage?.bind(this.ws);this.ws.onmessage=r=>{e&&e(r);let{token:n,type:i,body:s}=JSON.parse(r.data.toString());if(n!=this.token||i!="application")return;let{channel:a,args:f}=JSON.parse(s);this.emitter.emit(a,...f)}}whenReady(){return this.ready?Promise.resolve():new Promise(e=>{this.ws.addEventListener("open",()=>{e()})})}send(e,...r){(async()=>(await this.whenReady(),this.ws.send(JSON.stringify({id:this.id,token:this.token,body:JSON.stringify({channel:e,args:r})}))))()}invoke(e,...r){let n=u();return new Promise((i,s)=>{this.send(e,n,...r);let a=(f,l,m)=>{f==n&&(this.off(e,a),l?s(l):i(m))};this.emitter.on(e,a)})}static get(){return t.self||(t.self=new t),t.self}};function k(t){if(t=="kara")return{ipcRenderer:o.get()}}function x(){Object.defineProperty(window,"require",{value:k}),Object.defineProperty(window,"ipcRenderer",{value:o.get()}),o.get().on("_getURL",t=>{o.get().send("_getURL",t,location.href)})}x();})();
